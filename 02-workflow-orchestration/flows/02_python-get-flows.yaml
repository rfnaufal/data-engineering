id: get_flows_kestra
namespace: rfnaufal

variables:
  kestra_user: admin@kestra.io
  kestra_pass: Admin1234!

tasks:
  - id: python
    type: io.kestra.plugin.scripts.python.Script

    taskRunner:
      type: io.kestra.plugin.scripts.runner.docker.Docker
      extraHosts:
        - "host.docker.internal:host-gateway"

    dependencies:
      - requests
      - kestra

    script: |
      from kestra import Kestra
      import requests
      from requests.auth import HTTPBasicAuth

      url = "http://host.docker.internal:8080/api/v1/flows/search"

      r = requests.get(
          url,
          auth=HTTPBasicAuth(
              "{{ vars.kestra_user }}",
              "{{ vars.kestra_pass }}"
          ),
          timeout=30
      )

      Kestra.outputs({
          "status": r.status_code,
          "text": r.text[:2000]
      })
